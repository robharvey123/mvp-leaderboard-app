import{g as u,u as h,a as f,b as y,v as p,c as g,d as k,e as S,f as m,h as P,i as v,j as b,k as I,l as D,m as $,s as L,n as B,o as C,p as U,q as M}from"./index-NZoywgit.js";const F=async t=>{const a=u();try{const o=await x(t),r=await N(t,o.matchId);switch(await O(a,o,r.battingPerformances,r.bowlingPerformances,r.fieldingPerformances),a){case"localStorage":await y();break;case"supabase":await f();break;case"googleSheets":await h();break}console.log("Scorecard data processed and saved successfully")}catch(o){throw console.error("Error saving scorecard results:",o),new Error("Failed to save scorecard results")}};async function x(t){const a=new Date(t.match.date),o=p(),r=u();let s;switch(r){case"localStorage":s=await g();break;case"supabase":s=await S();break;case"googleSheets":s=await k();break;default:s=await g()}const w=s.find(d=>{const i=new Date(d.startDate),n=new Date(d.endDate);return a>=i&&a<=n})||s[s.length-1]||{seasonId:"current"};return{matchId:o,seasonId:w.seasonId,date:a.toISOString(),opposition:t.match.opposition,venue:t.match.venue||"Unknown",matchType:t.match.competition.includes("League")?"League":"Friendly",result:t.match.matchResult,scorecard:`${t.match.opposition} vs Brookweald CC`,brookwealdScore:t.match.brookwealdScore||"Not available",oppositionScore:t.match.oppositionScore||"Not available",notes:`Imported from scorecard on ${new Date().toLocaleDateString()}`,isComplete:!0}}async function N(t,a){const o=[],r=[],s=[],w=u();let l;switch(w){case"localStorage":l=await m();break;case"supabase":l=await v();break;case"googleSheets":l=await P();break;default:l=await m()}for(const d of t.players){const i=d.mvp,n=d.performance;let c=l.find(e=>e.name.toLowerCase()===i.playerName.toLowerCase());if(!c){const e={name:i.playerName,email:"",position:"Unknown",battingStyle:"Unknown",bowlingStyle:"Unknown",dateJoined:new Date().toISOString(),profileImage:"",isActive:!0};switch(w){case"localStorage":c=await b(e);break;case"supabase":c=await D(e);break;case"googleSheets":c=await I(e);break;default:c=await b(e)}}if(n.batting){const e=n.batting;o.push({performanceId:p(),matchId:a,playerId:c.playerId,runs:e.runs||0,ballsFaced:e.balls||0,fours:e.fours||0,sixes:e.sixes||0,howOut:e.status||"Unknown",battingPosition:e.position||0,mvpPoints:i.battingPoints||0})}if(n.bowling){const e=n.bowling;r.push({performanceId:p(),matchId:a,playerId:c.playerId,overs:e.overs||0,maidens:e.maidens||0,runs:e.runs||0,wickets:e.wickets||0,wides:e.wides||0,noBalls:e.no_balls||0,economy:e.economy||0,mvpPoints:i.bowlingPoints||0})}if(n.fielding){const e=n.fielding;s.push({performanceId:p(),matchId:a,playerId:c.playerId,catches:e.catches||0,runOuts:e.run_outs||0,stumpings:e.stumpings||0,mvpPoints:i.fieldingPoints||0})}}return{battingPerformances:o,bowlingPerformances:r,fieldingPerformances:s}}async function O(t,a,o,r,s){switch(t){case"localStorage":await U(a),await M(a.matchId,o,r,s);break;case"supabase":await B(a),await C(a.matchId,o,r,s);break;case"googleSheets":await $(a),await L(a.matchId,o,r,s);break;default:throw new Error(`Unknown backend: ${t}`)}}export{F as saveScorecardResults};
